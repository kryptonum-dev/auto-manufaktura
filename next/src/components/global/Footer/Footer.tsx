import sanityFetch from '@/utils/sanity.fetch';
import Link from 'next/link';
import Light from '@/components/ui/Light';
import CookieButton from './_CookieButton';
import Navigation from './_Navigation';
import type { FooterQueryTypes } from './Footer.types';
import styles from './Footer.module.scss';

export default async function Footer() {
  const links = await query();

  return (
    <footer className={styles['Footer']}>
      <Navigation {...links} />
      <div className={`max-width ${styles.links}`}>
        <p className={`${styles.copyright} text-m light`}>
          <span>Stworzone przez</span>
          <a
            href='https://kryptonum.eu/pl'
            target='_blank'
            rel='noreferrer'
            aria-label='Przejdź do strony Kryptonum'
          >
            <KryptonumLogo />
          </a>
        </p>
        <p className={`${styles.date} text-m light`}>{new Date().getFullYear()}</p>
        <div>
          <Link
            href='/polityka-prywatnosci'
            target='_blank'
            rel='noreferrer'
            className='text-m light'
          >
            Polityka prywatności
          </Link>
          <CookieButton />
        </div>
      </div>
      <div className={styles.svgText}>
        <AutomanufakturaText />
      </div>
      <Light
        size='large-responsive'
        className={styles.light}
      />
    </footer>
  );
}

const query = async (): Promise<FooterQueryTypes> => {
  const footerQuery = `
    {
      "services": coalesce(
        *[_type == "global"][0].footer.services[]->{
          name,
          "path": slug.current,
          "list": *[_type == "Service_Collection" && isSubPage && parentPage._ref == ^._id] | order(_createdAt asc){
            name,
            "path": slug.current
          } 
        },
        *[_type == "Service_Collection" && (!defined(isSubPage) || !isSubPage)] | order(_createdAt asc) [0...2]{
          name,
          "path": slug.current,
          "list": *[_type == "Service_Collection" && isSubPage && parentPage._ref == ^._id] | order(_createdAt asc){
            name,
            "path": slug.current
          } 
        }
      ),
      "carBrands": coalesce(
        *[_type == "global"][0].footer.carBrands[]->{
          name,
          "path": slug.current
        },
        *[_type == "CarBrand_Collection"] | order(_createdAt desc) {
          name,
          "path": slug.current
        }
      ),
      "locations": *[_type == "Location_Collection"] | order(_createdAt desc){
        name,
        "path": slug.current
      },
      "blogPage": *[_type == "Blog_Page"][0]{
        name,
        "path": slug.current
      },
      "aboutPage": *[_type == "About_Page"][0]{
        "name": "Zespół",
        "path": slug.current
      },
      "contactPage": *[_type == "Contact_Page"][0]{
        name,
        "path": slug.current
      },
      "pricingPage": *[_type == "Pricing_Page"][0]{
        name,
        "path": slug.current
      },
      "careerPage": *[_type == "Career_Page"][0]{
        "name": "Kariera",
        "path": slug.current,
        "isHiring": isHiring && count(jobOffers) > 0
      }
    }
  `;

  return await sanityFetch<FooterQueryTypes>({
    query: footerQuery,
    tags: [
      'global',
      'Service_Collection',
      'CarBrand_Collection',
      'Location_Collection',
      'Blog_Page',
      'About_Page',
      'Contact_Page',
      'Pricing_Page',
      'Career_Page',
    ],
  });
};

const KryptonumLogo = ({ ...props }) => (
  <svg
    xmlns='http://www.w3.org/2000/svg'
    width={77}
    height={18}
    viewBox='0 0 77 18'
    fill='none'
    {...props}
  >
    <path
      fill='url(#a)'
      d='M11.679 9c0 .665-.204 1.315-.585 1.871a3.545 3.545 0 0 1-1.562 1.26v5.748H6.67v-5.75a3.54 3.54 0 0 1-1.562-1.259A3.304 3.304 0 0 1 4.524 9c0-.664.203-1.314.584-1.87A3.54 3.54 0 0 1 6.67 5.87V.121h2.862V5.87a3.542 3.542 0 0 1 1.563 1.26c.38.556.584 1.206.584 1.871Z'
    />
    <path
      fill='url(#b)'
      d='M16.816 0v4.098l-2.99 2.853-1.43-1.366-.92.88a4.217 4.217 0 0 0-.717-.684L16.816 0Z'
    />
    <path
      fill='url(#c)'
      d='m13.827 11.05 2.989 2.852V18l-6.056-5.78c.265-.2.506-.43.715-.684l.921.88 1.43-1.367Z'
    />
    <path
      fill='#EFF0F3'
      d='M3.81 9c-.003.92.322 1.814.92 2.535L.947 15.147v-4.098l1.431-1.366V8.317L.948 6.951V2.853L4.73 6.464A3.958 3.958 0 0 0 3.81 9ZM23.52 13l-3.364-3.727V13H19.09V4.832h1.066v3.785l3.375-3.785h1.348l-3.703 4.09L24.914 13H23.52Zm2.597-5.379c.187-.367.453-.652.797-.855.351-.204.777-.305 1.277-.305v1.101h-.281c-1.196 0-1.793.649-1.793 1.946V13H25.05V6.578h1.067v1.043Zm8.543-1.043-3.867 9.445h-1.101l1.265-3.093-2.59-6.352h1.184l2.016 5.203 1.992-5.203h1.101Zm1.318 1.184a2.51 2.51 0 0 1 .938-.914c.422-.25.91-.375 1.465-.375.57 0 1.086.136 1.547.41.468.273.836.66 1.101 1.16.266.492.399 1.066.399 1.723 0 .648-.133 1.226-.399 1.734a2.932 2.932 0 0 1-2.648 1.605c-.547 0-1.032-.12-1.453-.363a2.7 2.7 0 0 1-.95-.926v4.23h-1.066V6.579h1.066v1.184Zm4.36 2.004c0-.485-.098-.907-.293-1.266a2.016 2.016 0 0 0-.797-.82 2.158 2.158 0 0 0-1.09-.282c-.39 0-.754.098-1.09.293a2.1 2.1 0 0 0-.797.832c-.195.36-.293.778-.293 1.254 0 .485.098.91.293 1.278.203.36.47.636.797.832a2.2 2.2 0 0 0 1.09.281c.398 0 .762-.094 1.09-.281.336-.196.602-.473.797-.832.195-.367.293-.797.293-1.29Zm2.915-2.309v3.785c0 .313.067.535.2.668.132.125.363.188.69.188h.786V13h-.961c-.594 0-1.039-.137-1.336-.41-.297-.274-.445-.723-.445-1.348V7.457h-.832v-.879h.832V4.961h1.066v1.617h1.676v.879h-1.676Zm4.89 5.648a3.321 3.321 0 0 1-1.64-.41 2.98 2.98 0 0 1-1.15-1.16c-.273-.508-.41-1.094-.41-1.758 0-.656.141-1.234.423-1.734.289-.508.68-.895 1.171-1.16a3.344 3.344 0 0 1 1.653-.41c.61 0 1.16.136 1.652.41a2.88 2.88 0 0 1 1.16 1.148c.29.5.434 1.082.434 1.746 0 .664-.149 1.25-.445 1.758-.29.5-.684.887-1.184 1.16-.5.274-1.055.41-1.664.41Zm0-.937c.383 0 .742-.09 1.078-.27.336-.18.606-.449.809-.808.21-.36.316-.797.316-1.313 0-.515-.101-.953-.305-1.312a1.956 1.956 0 0 0-.796-.797 2.185 2.185 0 0 0-1.067-.27c-.39 0-.75.09-1.078.27-.32.172-.578.437-.773.797-.196.36-.294.797-.294 1.312 0 .524.094.965.282 1.325.195.359.453.628.773.808.32.172.672.258 1.055.258Zm6.945-5.707c.781 0 1.414.238 1.898.715.485.469.727 1.148.727 2.039V13h-1.055V9.367c0-.64-.16-1.129-.48-1.465-.32-.343-.758-.515-1.313-.515-.562 0-1.011.176-1.347.527-.328.352-.492.863-.492 1.535V13h-1.067V6.578h1.066v.914c.212-.328.497-.582.856-.762.367-.18.77-.27 1.207-.27Zm9.008.117V13h-1.067v-.95a2.108 2.108 0 0 1-.855.774c-.36.18-.758.27-1.196.27-.5 0-.949-.102-1.347-.305a2.332 2.332 0 0 1-.95-.937c-.226-.415-.34-.918-.34-1.512V6.578h1.055V10.2c0 .633.16 1.121.48 1.465.321.336.759.504 1.313.504.57 0 1.02-.176 1.348-.527.328-.352.492-.864.492-1.536V6.578h1.067Zm8.468-.117c.5 0 .946.105 1.336.316.39.203.7.512.926.926.226.414.34.918.34 1.512V13H74.11V9.367c0-.64-.16-1.129-.48-1.465-.313-.343-.739-.515-1.278-.515-.554 0-.996.18-1.324.539-.328.351-.492.863-.492 1.535V13h-1.055V9.367c0-.64-.16-1.129-.48-1.465-.313-.343-.739-.515-1.278-.515-.554 0-.996.18-1.324.539-.328.351-.492.863-.492 1.535V13H64.84V6.578h1.067v.926c.21-.336.492-.594.844-.774.359-.18.754-.27 1.183-.27.54 0 1.016.122 1.43.364.414.242.723.598.926 1.067.18-.454.476-.805.89-1.055.414-.25.875-.375 1.383-.375Z'
    />
    <defs>
      <linearGradient
        id='a'
        x1={11.544}
        x2={4.073}
        y1={0.121}
        y2={0.313}
        gradientUnits='userSpaceOnUse'
      >
        <stop stopColor='#2DD282' />
        <stop
          offset={1}
          stopColor='#90F4E8'
        />
      </linearGradient>
      <linearGradient
        id='b'
        x1={16.702}
        x2={10.393}
        y1={0}
        y2={0.35}
        gradientUnits='userSpaceOnUse'
      >
        <stop stopColor='#2DD282' />
        <stop
          offset={1}
          stopColor='#90F4E8'
        />
      </linearGradient>
      <linearGradient
        id='c'
        x1={16.702}
        x2={10.393}
        y1={11.049}
        y2={11.399}
        gradientUnits='userSpaceOnUse'
      >
        <stop stopColor='#2DD282' />
        <stop
          offset={1}
          stopColor='#90F4E8'
        />
      </linearGradient>
    </defs>
  </svg>
);

const AutomanufakturaText = ({ ...props }) => (
  <svg
    xmlns='http://www.w3.org/2000/svg'
    width={1358}
    height={110}
    viewBox='0 0 1358 110'
    fill='none'
    {...props}
  >
    <path
      fill='#111317'
      d='M.345 107.648 38.382 1.468h22.616l37.964 106.18H77.594l-8.665-24.599H30.745l-8.885 24.599H.345Zm35.173-43.323h28.27l-14.024-42.15-14.246 42.15ZM180.445 67.188c0 8.567-1.395 16.008-4.186 22.323-2.79 6.266-7.318 11.113-13.584 14.539-6.217 3.378-14.466 5.067-24.746 5.067-10.329 0-18.602-1.713-24.819-5.14-6.217-3.476-10.721-8.396-13.511-14.76-2.742-6.364-4.113-13.951-4.113-22.763V1.47h21.809v66.6c0 7.931 1.909 13.732 5.728 17.403 3.818 3.623 8.787 5.434 14.906 5.434 4.063 0 7.661-.783 10.794-2.35 3.133-1.615 5.581-4.087 7.343-7.416 1.811-3.378 2.717-7.734 2.717-13.07V1.469h21.662v65.72Z'
    />
    <path
      fill='#111317'
      d='M177.968 20.56V1.47h84.958V20.56h-31.354v87.088h-21.515V20.56h-32.089ZM306.585 109.117c-10.035 0-18.725-2.178-26.068-6.535-7.294-4.406-12.948-10.648-16.962-18.725-3.965-8.126-5.948-17.819-5.948-29.078 0-11.308 2.007-21.05 6.021-29.225 4.064-8.176 9.767-14.466 17.11-18.872C288.081 2.227 296.696 0 306.585 0c9.84 0 18.406 2.203 25.701 6.609 7.294 4.405 12.923 10.696 16.888 18.871 4.015 8.175 6.022 17.942 6.022 29.299 0 11.21-1.983 20.878-5.948 29.005-3.916 8.126-9.522 14.392-16.816 18.798-7.294 4.357-15.909 6.535-25.847 6.535Zm0-17.623c5.189 0 9.668-1.224 13.438-3.672 3.818-2.496 6.755-6.413 8.811-11.749 2.056-5.384 3.084-12.385 3.084-21 0-8.861-1.052-16.033-3.157-21.516-2.056-5.482-4.993-9.496-8.812-12.042-3.769-2.595-8.224-3.892-13.364-3.892-5.14 0-9.619 1.297-13.438 3.892-3.818 2.546-6.78 6.584-8.885 12.116-2.105 5.483-3.157 12.63-3.157 21.441 0 8.665 1.052 15.666 3.157 21.001 2.105 5.336 5.067 9.253 8.885 11.75 3.819 2.447 8.298 3.67 13.438 3.67ZM359.49 107.648V1.468h31.134l24.306 75.707 24.525-75.706h31.061v106.179h-21.662V26.435l-25.553 81.213h-16.816l-25.406-80.846v80.846H359.49ZM471.76 107.648l38.037-106.18h22.616l37.964 106.18h-21.369l-8.664-24.599H502.16l-8.885 24.599H471.76Zm35.173-43.323h28.271l-14.026-42.15-14.245 42.15ZM641.319 1.469h21.442v106.179h-19.312l-50.447-73.063v73.063h-21.368V1.468h21.221l48.464 70.273V1.47ZM755.207 67.188c0 8.567-1.395 16.008-4.186 22.323-2.79 6.266-7.318 11.113-13.584 14.539-6.217 3.378-14.466 5.067-24.746 5.067-10.329 0-18.602-1.713-24.82-5.14-6.217-3.476-10.72-8.396-13.511-14.76-2.741-6.364-4.112-13.951-4.112-22.763V1.47h21.809v66.6c0 7.931 1.909 13.732 5.727 17.403 3.819 3.623 8.788 5.434 14.907 5.434 4.063 0 7.661-.783 10.794-2.35 3.133-1.615 5.581-4.087 7.343-7.416 1.811-3.378 2.717-7.734 2.717-13.07V1.469h21.662v65.72ZM761.835 1.469h72.255l-.073 17.917h-50.594V46.04h43.838v17.55h-43.838v44.057h-21.588V1.468ZM819.463 107.648l38.036-106.18h22.617l37.963 106.18h-21.368l-8.665-24.599h-38.183l-8.885 24.599h-21.515Zm35.172-43.323h28.271l-14.025-42.15-14.246 42.15ZM1008.77 107.648h-23.346L957.3 58.23l-15.714 18.945v30.473h-22.25V1.468h22.25V50.08l38.697-48.61h24.597l-32.233 41.12 36.123 65.059Z'
    />
    <path
      fill='#111317'
      d='M1001.82 20.56V1.47h84.96V20.56h-31.36v87.088h-21.51V20.56h-32.09Z'
    />
    <path
      fill='#111317'
      d='M1171.69 67.188c0 8.567-1.39 16.008-4.18 22.323-2.79 6.266-7.32 11.113-13.59 14.539-6.21 3.378-14.46 5.067-24.74 5.067-10.33 0-18.61-1.713-24.82-5.14-6.22-3.476-10.72-8.396-13.51-14.76-2.75-6.364-4.12-13.951-4.12-22.763V1.47h21.81v66.6c0 7.931 1.91 13.732 5.73 17.403 3.82 3.623 8.79 5.434 14.91 5.434 4.06 0 7.66-.783 10.79-2.35 3.13-1.615 5.58-4.087 7.34-7.416 1.81-3.378 2.72-7.734 2.72-13.07V1.469h21.66v65.72ZM1260.71 107.648h-22.25l-17.26-40.9h-21.51v40.9h-21.37V1.468h44.79c8.47 0 15.4 1.347 20.78 4.04 5.39 2.692 9.35 6.437 11.9 11.234 2.54 4.748 3.82 10.231 3.82 16.448 0 5.581-.88 10.305-2.65 14.172-1.71 3.819-3.99 7-6.82 9.546-2.8 2.546-5.85 4.626-9.18 6.242l19.75 44.498Zm-41.42-57.422c5.73 0 10.26-1.542 13.59-4.626 3.38-3.084 5.07-7.05 5.07-11.896 0-4.895-1.62-8.762-4.85-11.602-3.23-2.839-7.32-4.259-12.26-4.259h-21.15v32.383h19.6Z'
    />
    <path
      fill='#111317'
      d='m1259.04 107.648 38.04-106.18h22.61l37.97 106.18h-21.37l-8.67-24.599h-38.18l-8.89 24.599h-21.51Zm35.17-43.323h28.27l-14.02-42.15-14.25 42.15Z'
    />
  </svg>
);
